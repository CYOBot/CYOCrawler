"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[952],{8952:function(e,t,s){s.r(t),s.d(t,{CodeEditorMVP:function(){return x}});var a=s(9219),n=s(4096),l=s(6833),o=s(2564);let c=()=>{let{code:e,setCode:t}=(0,o.useContext)(l.q);return{code:e,setCode:t}},i=e=>{let[t,s]=(0,o.useState)(""),[a,n]=(0,o.useState)("normal");return(0,o.useEffect)(()=>{let t=e.findIndex(e=>"OK"===e);if(-1===t){s("");return}let a=e.findIndex(e=>"\x04"===e);if(-1===a)return;let l=e.findLastIndex(e=>"\x04"===e);if(t===a-1){if(-1===l)throw"lastEndOfTransmissionIndex should not be -1 if an error occur in user code";n("error"),s(e.slice(a+1,l).join(""))}else n("normal"),s(e.slice(t+1,a).join(""))},[e]),{consoleOutput:t,setConsoleOutput:s,outputStatus:a,setOutputStatus:n}};var r=s(1392),d=s(1991);let u=()=>{let{clientResponses:e,setClientResponses:t}=(0,o.useContext)(d.L);return{clientResponses:e,setClientResponses:t}};var h=s(6078),f=s(3380),C=s(115),k=s(6523);let x=()=>{let{code:e,setCode:t}=c();(0,o.useEffect)(()=>{""===e&&t('print("hello world")')},[]);let{client:s}=(0,r.x)(),{clientResponses:l,setClientResponses:d}=u(),[x,b]=(0,o.useState)(!1);(0,o.useEffect)(()=>{s.addOnMessageReceiveCallback("onMessageReceive",e=>{d(t=>[...t,e]),b(!1)}),s.connect()},[s,d]);let{consoleOutput:v,outputStatus:p}=i(l),S=(0,o.useCallback)(()=>{s.send(e),d([]),b(!0)},[s,e,d]),g=(0,o.useCallback)(()=>{s.interrupt()},[s]);return(0,a.jsxs)("div",{className:"px-6 py-4 w-full h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"flex-1 relative flex flex-col",children:[(0,a.jsx)(k.k,{children:"Code Editor"}),(0,a.jsx)("div",{className:"absolute top-12 w-full h-[calc(100%-40px-48px-8px)] bg-muted",children:(0,a.jsx)(f.ZP,{className:"h-full text-lg overflow-y-auto",value:e,onChange:t,extensions:[(0,h.Vs)()]})}),(0,a.jsx)("div",{className:"absolute bottom-0 w-full flex justify-end",children:(0,a.jsxs)(n.z,{variant:"muted",onClick:()=>t(""),children:[(0,a.jsx)(C.Z,{className:"h-4 w-4 mr-1.5"}),"Clear"]})})]}),(0,a.jsxs)("div",{className:"flex-1 relative flex flex-col",children:[(0,a.jsx)(k.k,{children:"Console"}),(0,a.jsx)("div",{className:"absolute top-12 w-full h-[calc(100%-40px-48px-8px)] bg-muted px-4 py-2 whitespace-pre-line font-mono rounded-lg overflow-y-auto ".concat("normal"===p?"text-primary":"text-destructive"),children:v}),(0,a.jsxs)("div",{className:"absolute bottom-0 w-full flex flex-row justify-end space-x-4",children:[(0,a.jsx)(n.z,{variant:"destructive",className:"text-background",onClick:g,children:"Break"}),(0,a.jsx)(n.z,{variant:"positive",className:"text-primary",onClick:S,children:"Run"})]})]})]})}},6833:function(e,t,s){s.d(t,{q:function(){return l}});var a=s(3916),n=s(2564);let l=(0,n.createContext)({code:"",setCode:a.Z})},1679:function(e,t,s){s.d(t,{p:function(){return o}});var a=s(810),n=s(2072),l=s(2564);let o=(0,l.createContext)(new n.v({endpoint:a.u.pythonWebREPL.endpoint,password:a.u.pythonWebREPL.password}))},1991:function(e,t,s){s.d(t,{L:function(){return l}});var a=s(3916),n=s(2564);let l=(0,n.createContext)({clientResponses:[],setClientResponses:a.Z})},1392:function(e,t,s){s.d(t,{x:function(){return l}});var a=s(1679),n=s(2564);let l=()=>{let e=(0,n.useContext)(a.p),[t,s]=(0,n.useState)(e.status),[l,o]=(0,n.useState)(!1);(0,n.useEffect)(()=>{e.addOnAfterStatusChangedCallback("setStatusCallback",(e,t)=>s(t))},[e]),(0,n.useEffect)(()=>(l&&e.connect(),()=>{e.close()}),[l]);let c=(0,n.useCallback)(()=>{e.close(),setTimeout(()=>o(e=>!e),500),setTimeout(()=>o(e=>!e),1e3)},[e]);return{client:e,status:t,refetchStatus:c}}},2072:function(e,t,s){s.d(t,{v:function(){return l}});let a=e=>(" "+e).slice(1);var n=s(7883);class l{connect(){var e;"connected"===this.status&&(null===(e=this.socket)||void 0===e||e.close()),this.setStatus("loading"),setTimeout(()=>{"loading"===this.status&&this.setStatus("disconnected")},3e3),this.socket=new n.w3cwebsocket(this.endpoint),this.socket.onopen=()=>{var e;null===(e=this.socket)||void 0===e||e.send("".concat(this.password,"\n"))},this.socket.onmessage=async e=>{if("connected"!==this.status)"\r\nWebREPL connected\r\n>>> "===e.data?this.setStatus("connected"):this.setStatus("disconnected");else if("connected"===this.status)for(let t=0;t<this.onMessageReceiveCallbacks.length;t++)await this.onMessageReceiveCallbacks[t](e.data.toString())},this.socket.onerror=e=>{console.error(e)}}close(){var e;null===(e=this.socket)||void 0===e||e.close(),this.setStatus("disconnected")}async send(e){let t=async()=>{let t=a(e);if(this.socket){for(this.socket.send('\x01_g=globals().copy();_g.pop("_g", None);'),this.socket.send('exec("""');""!==t;)this.socket.send(t.substring(0,20)),t=t.substring(20),await new Promise(e=>setTimeout(e,50));this.socket.send('\n""", _g)\x04')}};for(let t=0;t<this.onBeforeSendCallbacks.length;t++)await this.onBeforeSendCallbacks[t](e);await t();for(let t=0;t<this.onAfterSentCallbacks.length;t++)await this.onAfterSentCallbacks[t](e)}async interrupt(){var e;null===(e=this.socket)||void 0===e||e.send("\x02\x03")}async softReset(){var e;null===(e=this.socket)||void 0===e||e.send("\x02\x04")}async setStatus(e){let t=this.status;Object.defineProperty(this,"status",{writable:!1,configurable:!0,value:e});for(let s=0;s<this.onAfterStatusChangedCallbacks.length;s++)await this.onAfterStatusChangedCallbacks[s](t,e)}addOnMessageReceiveCallback(e,t){this.onMessageReceiveCallbackIds.has(e)||(this.onMessageReceiveCallbacks.push(t),this.onMessageReceiveCallbackIds.add(e))}addOnAfterStatusChangedCallback(e,t){this.onAfterStatusChangedCallbackIds.has(e)||(this.onAfterStatusChangedCallbacks.push(t),this.onAfterStatusChangedCallbackIds.add(e))}addOnBeforeSendCallbacks(e,t){this.onBeforeSendCallbackIds.has(e)||(this.onBeforeSendCallbacks.push(t),this.onBeforeSendCallbackIds.add(e))}addOnAfterSentCallbacks(e,t){this.onAfterSentCallbackIds.has(e)||(this.onAfterSentCallbacks.push(t),this.onAfterSentCallbackIds.add(e))}constructor({endpoint:e,password:t}){this.onMessageReceiveCallbacks=[],this.onMessageReceiveCallbackIds=new Set,this.onAfterStatusChangedCallbacks=[],this.onAfterStatusChangedCallbackIds=new Set,this.onBeforeSendCallbacks=[],this.onBeforeSendCallbackIds=new Set,this.onAfterSentCallbacks=[],this.onAfterSentCallbackIds=new Set,this.endpoint=e,this.password=t,this.status="disconnected"}}}}]);