"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[257],{9257:function(e,t,s){s.r(t),s.d(t,{CodeEditor:function(){return f}});var n=s(9219),a=s(1382),o=s(1392),l=s(1927),i=s(2564),r=s(6078),c=s(3380),d=s(2085),u=s(5772);let h=e=>{let[t,s]=(0,i.useState)(""),[n,a]=(0,i.useState)("normal");return(0,i.useEffect)(()=>{let t=e.findIndex(e=>"OK"===e);if(-1===t){s("");return}let n=e.findIndex(e=>"\x04"===e);if(-1===n)return;let o=e.findLastIndex(e=>"\x04"===e);if(t===n-1){if(-1===o)throw"lastEndOfTransmissionIndex should not be -1 if an error occur in user code";a("error"),s(e.slice(n+1,o).join(""))}else a("normal"),s(e.slice(t+1,n).join(""))},[e]),{consoleOutput:t,setConsoleOutput:s,outputStatus:n,setOutputStatus:a}},f=()=>{let{code:e,setCode:t}=(0,a.h)();(0,i.useEffect)(()=>{""===e&&t('print("hello world")')},[]);let{height:s}=function(){let e=(0,i.useCallback)(()=>{let e=window.innerWidth,t=window.innerHeight;return{width:e,height:t}},[!0]),[t,s]=(0,i.useState)(e());return(0,i.useEffect)(()=>{let t=()=>s(e());return window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[e,!0]),t}(),{client:f}=(0,o.x)(),{clientResponses:b,setClientResponses:C}=(0,l.v)();(0,i.useEffect)(()=>{f.addOnMessageReceiveCallback("onMessageReceive",e=>{C(t=>[...t,e])}),f.connect()},[f,C]);let{consoleOutput:k,outputStatus:g}=h(b);return(0,n.jsxs)("div",{className:"px-6 py-4 w-full h-full flex flex-col",children:[null!==s&&(0,n.jsx)(u.ResizableBox,{height:(s-112)/2,minConstraints:[0,100],maxConstraints:[0,s-240],axis:"y",className:"flex flex-col",handle:(0,n.jsx)("div",{className:"mx-auto w-12 py-1 cursor-row-resize pointer-events-auto",children:(0,n.jsx)("div",{className:"h-1 bg-muted rounded-lg"})}),children:(0,n.jsx)(c.ZP,{className:"text-lg flex-1 overflow-y-auto bg-muted rounded-lg",value:e,onChange:t,extensions:[(0,r.Vs)()]})}),(0,n.jsx)("div",{className:"flex flex-col flex-1 overflow-y-auto",children:(0,n.jsxs)("div",{className:"flex-1 bg-muted px-6 py-4 mb-2 whitespace-pre-line font-mono rounded-lg ".concat("normal"===g?"text-primary":"text-destructive"),children:[(0,n.jsxs)("div",{className:"flex items-center border-b border-muted-foreground pb-1 mb-1",children:[(0,n.jsx)(d.Z,{className:"w-4 h-4 mr-2"}),"Output"]}),k]})})]})}},9723:function(e,t,s){s.d(t,{D:function(){return n}});let n={pythonWebREPL:{endpoint:"ws://192.168.4.1:8266",password:"cyobot"}}},6833:function(e,t,s){s.d(t,{q:function(){return o}});var n=s(3916),a=s(2564);let o=(0,a.createContext)({code:"",setCode:n.Z})},1679:function(e,t,s){s.d(t,{p:function(){return l}});var n=s(9723),a=s(2072),o=s(2564);let l=(0,o.createContext)(new a.v({endpoint:n.D.pythonWebREPL.endpoint}))},1991:function(e,t,s){s.d(t,{L:function(){return o}});var n=s(3916),a=s(2564);let o=(0,a.createContext)({clientResponses:[],setClientResponses:n.Z})},1382:function(e,t,s){s.d(t,{h:function(){return o}});var n=s(6833),a=s(2564);let o=()=>{let{code:e,setCode:t}=(0,a.useContext)(n.q);return{code:e,setCode:t}}},1927:function(e,t,s){s.d(t,{v:function(){return o}});var n=s(1991),a=s(2564);let o=()=>{let{clientResponses:e,setClientResponses:t}=(0,a.useContext)(n.L);return{clientResponses:e,setClientResponses:t}}},1392:function(e,t,s){s.d(t,{x:function(){return o}});var n=s(1679),a=s(2564);let o=()=>{let e=(0,a.useContext)(n.p),[t,s]=(0,a.useState)(e.status);return(0,a.useEffect)(()=>{e.addOnAfterStatusChangedCallback("setStatusCallback",(e,t)=>s(t))},[e]),{client:e,status:t}}},2072:function(e,t,s){s.d(t,{v:function(){return l}});var n=s(9723);let a=e=>(" "+e).slice(1);var o=s(7883);class l{connect(){var e;"connected"===this.status&&(null===(e=this.socket)||void 0===e||e.close()),this.setStatus("loading"),setTimeout(()=>{"loading"===this.status&&this.setStatus("disconnected")},3e3),this.socket=new o.w3cwebsocket(n.D.pythonWebREPL.endpoint),this.socket.onopen=()=>{var e;null===(e=this.socket)||void 0===e||e.send("".concat(n.D.pythonWebREPL.password,"\n"))},this.socket.onmessage=async e=>{if("connected"!==this.status)"\r\nWebREPL connected\r\n>>> "===e.data?this.setStatus("connected"):this.setStatus("disconnected");else if("connected"===this.status)for(let t=0;t<this.onMessageReceiveCallbacks.length;t++)await this.onMessageReceiveCallbacks[t](e.data.toString())},this.socket.onerror=e=>{console.error(e)}}async send(e){let t=async()=>{let t=a(e);if(this.socket){for(this.socket.send('\x01_g=globals().copy();_g.pop("_g", None);'),this.socket.send('exec("""');""!==t;)this.socket.send(t.substring(0,20)),t=t.substring(20),await new Promise(e=>setTimeout(e,50));this.socket.send('\n""", _g)\x04')}};for(let t=0;t<this.onBeforeSendCallbacks.length;t++)await this.onBeforeSendCallbacks[t](e);await t();for(let t=0;t<this.onAfterSentCallbacks.length;t++)await this.onAfterSentCallbacks[t](e)}async setStatus(e){let t=this.status;Object.defineProperty(this,"status",{writable:!1,configurable:!0,value:e});for(let s=0;s<this.onAfterStatusChangedCallbacks.length;s++)await this.onAfterStatusChangedCallbacks[s](t,e)}addOnMessageReceiveCallback(e,t){this.onMessageReceiveCallbackIds.has(e)||(this.onMessageReceiveCallbacks.push(t),this.onMessageReceiveCallbackIds.add(e))}addOnAfterStatusChangedCallback(e,t){this.onAfterStatusChangedCallbackIds.has(e)||(this.onAfterStatusChangedCallbacks.push(t),this.onAfterStatusChangedCallbackIds.add(e))}addOnBeforeSendCallbacks(e,t){this.onBeforeSendCallbackIds.has(e)||(this.onBeforeSendCallbacks.push(t),this.onBeforeSendCallbackIds.add(e))}addOnAfterSentCallbacks(e,t){this.onAfterSentCallbackIds.has(e)||(this.onAfterSentCallbacks.push(t),this.onAfterSentCallbackIds.add(e))}constructor({endpoint:e}){this.onMessageReceiveCallbacks=[],this.onMessageReceiveCallbackIds=new Set,this.onAfterStatusChangedCallbacks=[],this.onAfterStatusChangedCallbackIds=new Set,this.onBeforeSendCallbacks=[],this.onBeforeSendCallbackIds=new Set,this.onAfterSentCallbacks=[],this.onAfterSentCallbackIds=new Set,this.endpoint=e,this.status="disconnected"}}},3916:function(e,t,s){s.d(t,{Z:function(){return n}});let n=function(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s]}}}]);